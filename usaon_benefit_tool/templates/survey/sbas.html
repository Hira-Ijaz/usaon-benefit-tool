{% extends 'survey/base.html' %}
{% from 'bootstrap5/form.html' import render_form %}
{% from 'bootstrap5/utils.html' import render_icon %}
{% from 'macros/buttons.j2' import delete_button, create_button %}
{% from 'macros/javascript_highcharts.j2' import display_sankey %}


{% block content %}
  {{super()}}

  <div class="two-columns">
    <div>
      <h3>Societal benefit areas</h3>
      <table>
        <tr>
          <th rowspan="2">SBA ID</th>
          <th colspan="3">Related Applications</th>
        </tr>
        <tr>
          <th>Name</th>
          <th>Performance Rating</th>
          <th>Edit Relationships</th>
        </tr>
        {% for societal_benefit_area in response.societal_benefit_areas %}
          <tr>
            <td>{{societal_benefit_area.societal_benefit_area_id}}
              {{delete_button(
                'sba.delete_response_sba',
                'Delete object',
                survey_id=survey.id,
                response_societal_benefit_area_id=societal_benefit_area.id,
              )}}
            </td>
            <td>
              {% if not societal_benefit_area.input_relationships %}
                None
                <br />
              {% endif %}

              <ul>
                {% for input_relationship in societal_benefit_area.input_relationships %}
                  <li>{{input_relationship.application.short_name}}</li>
                {% endfor %}
              </ul>
            </td>
            <td>
              <ul>
                {% for input_relationship in societal_benefit_area.input_relationships %}
                  <li>{{input_relationship.performance_rating}}</li>
                {% endfor %}
              </ul>
            </td>
            <td>
              {{create_button(
                'application_societal_benefit_area.view_response_application_societal_benefit_area_relationships',
                'New relationship',
                survey_id=survey.id,
                societal_benefit_area_id=societal_benefit_area.id,
              )}}
              {% for input_relationship in societal_benefit_area.input_relationships %}
                <li>
                  {{delete_button(
                    'application_societal_benefit_area.delete_response_application_societal_benefit_area_relationship',
                    'Delete relationship',
                    survey_id=survey.id,
                    response_application_societal_benefit_area_id=input_relationship.id,
                  )}}
                </li>
              {% endfor %}
            </td>
          </tr>
        {% endfor %}
      </table>
      <br></br>
      {% if not current_user.role_id not in ['admin', 'respondent'] %}
        <h3>Assign societal benefit area</h3>
        <form method="POST">
          {{render_form(form, button_map={'submit_button': 'primary'}) }}

        </form>
      {% endif %}
    </div>

    {{ display_sankey(sankey_series) }}
  </div>

{% endblock %}
